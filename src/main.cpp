#include <Manifest.hpp>
#include <Timer.hpp>
#include <Tatsu.hpp>
#include <filesystem>
#include <fmt/color.h>
#include <chrono>
#include <thread>

int main() {
    std::vector<std::string> compList {
        "SEP",
    };
    std::vector<std::string> digestList {
        "",
    };
    std::vector<std::string> checkDigests {
            "004fc56f7cbfdc8abd4a574237b91d1d952ef0d82b69d424d5b779662aa85cfa057039c828ed0d16f2f37ec88bf2fe390a",
            "01bfb0359bb51ef4d1ef930674fc1397013d75ee3520c50c15f9375f4e227026b8fdd2171ef1b1b34e34bbcd757c686f0a",
            "048b6d26c6998ca59d1d938b59c909927ef7303b9084683c43f31e37447184213fd7ea08d9e8e5399cbe3422f8f402e40a",
            "04979cbb9c96cb8e15b541aef3ccce2e5c7e665e8cd716420cc01582f90b8ff9e38e8ffb0f2328e53a1cf05f6de7d5aa0a",
            "09bfd548fe4843fa331a4cec18d0cfd3f00eedc4d9c869d6a951aa177dd1f2f7f785907cbdb781d14a655ba1534ffa440a",
            "0bfeb972c330956edf216f67362f80c73c68be3654a37abb6f3008f4b2e5e987611e1457528f7f7ddd554998706bbe7c0a",
            "10c22a30698ffbb512a2800a836cc897457887dbcc79d65e6fabcff1c04bce739dc9403f820069dabd672833cb6992e20a",
            "130d716e5bb12a042f3dd230cee43d4804587ad6a6ac105b7a02fb81965c99509ce40ed675c743ce0440faa3084343010a",
            "1e9c0fa859abb50c553f5a2f146e8a9a2aab4b8acd25e1ebc293d54bc65b1e3ffef85a843e229796d745817a81ce43fd0a",
            "23846a124441ac1b2ab52a4b805cbd36f992fdbcda6422c76811f1a4fbda180c7d4080abc99117d5d71fa6e81e63fea90a",
            "238d676feb3c3593abd8e77a57c70f1300cac20982da2f81409836e7c0b64d675f1729cd1f398a983d78db48fbdf9f6e0a",
            "251c2563d10028930ebb6ca374b8cc2a87e4b8fc6303fd7eece2fe308d646fd7fce50dbc5791f63dff4601d4bf133e260a",
            "2590f47b9de10aba175e70c429858ab444d2fd12eab7a470011d9596a813065f4d601884c085cfcb4aea13e3be08750c0a",
            "25be2002e7f123ea897f4e41fc8ff1abe389e8d9d67a9bb99be0bcd0ef0c6df821500178b8241fef2887faf1b8a3d97a0a",
            "26471d4ce6ca8d2fa626d9cf3469f2dc9d8df38824229c7e4ef503f30452c0c5bb5ae17a0df42b448b9a5892cb79fa8f0a",
            "27de4de171055e40c13b12bb8c3c35375a5458be81b9a1cca78222d570945ac2f0413cfc47b1f4fbe5be6aaa4305e6000a",
            "296bc82ce334c0d800dc587b2695e046a6546d52219b008b4162acc8d119063161303c35d978d42cd9c698ca154d4dc50a",
            "2ae5a3fa5c1eb00763678a5a1a0c25b6344891e68364196d7b7cfa65080a030d870665f8dfd71f5f6b53cefa1fe20e7d0a",
            "2c2909612ef004d3fbd9f5e4da2597cca7be1a34e1d14ea8d095dcc99ad8b13344cc42761365d86128cf4d8e2fd405920a",
            "37621e73fe2ec8d828c2ab0023e4a5eaf21d09280dd485b5a7dfda29a4cae95a52ffcf453528f9f858dee3585cf3cadc0a",
            "388dc48bca0321639da378c894e0b2fa2f3bd8f10f4ef2447a311853e9a738ac898d1dd0cb7519b93460f517d56bf0100a",
            "3a00a421b9e365c939d066c513117ff6c73275e9d4cd83bfefe51fd651ddaa4fa5c030fb503912acd68050bbc8bac1980a",
            "3a23ddfc0f94e601da818215f14a9883057bf76f02a54533c05efa0cbd7fc62943fd66262acde3813b193bc2b14c4eea0a",
            "3b896c70dccdd70943eb00689b3d671afe0caa346c6a39109ff41ed92bf2a362bf9228687a51cab575332eccd941c05b0a",
            "3d29619a63acba2bc34749f88fe6c79016f795f571bcbca06b065aaf94dc20c106fb9ce13de0bbeaf578e96f68d4e49e0a",
            "3d9e79b3e2bbfe18aea38d7304f02bd3d831d5c7cdc97c45153af85b76a88c20e17b30cb950c3532f7ea469f5ae1d9040a",
            "446880eea0f5bbfafd54ab16460eb6b06b4fc632f1bce4473149306f81ed88aa3b81dbe4a1ec174f64a162248a08b7350a",
            "44c5ed4bf1e4b9fb9db86142c3a24c00384e85492169cf31ed631940feead3fbf0a499c246f87e6ef9c2a263f1c55cde0a",
            "45875e8777b35e8e7548f25961fb37e2a6fd8a3e8db79e0b855b5cb3cbf0d6a88158ceca5eab2564772bbe2e33b815ca0a",
            "45edb36861374bc1f90ed25a09247e4c2d848990b20302c778394d6f9b6ab0af70ca100dbd355e64484906fafceba65e0a",
            "4691c659a42e3f3d583245cac198f222948cd7af7e2a8887c8636f3557410e37daaa251862344f39942df8b309d5a9c80a",
            "46e634c83570b69483534e4071d1762bb60676498d0d984bc70dd97795e1c69e6e092b9fb6c5cc9198b8d30df8cdad2c0a",
            "4ae5a6ec5ca33060213d21c136334f16eda0ac16a21c9edf8aeac829e1f0ab081d126d0eb66f66284fd1635127a7b11d0a",
            "4ed69b2b7f3a19b1fe3c9ce223376c8f12fb94123837e6285d660df37cc85021f48eabc9bbbc3fb46460d4517fec1f7f0a",
            "512840116f8950a8bee850d65aa169f7566b93a0e97df8e644d280e656c9730f6e0202e8df2caa9132cafead370d30050a",
            "5668c3ae7320b02dbbc6b0cb3f721fdeb2bb98a5e19b643e9364a5da525dd0c050066c6aefe2722dfae8533274fb30810a",
            "57cf6280390284a48d0ab2fa7515f1eccb0564768d2fea2567267f28a9483f438d0e53ace613a97c943bc06989e43e160a",
            "5a32e656c7aae27971a09a0e54b5ce6ffa480ebb8a3372e6d9db3820bca97002ce1623fe9358ff76fc75d606d370e8ec0a",
            "5b32eaa8a7168d31b06b0b157dcadf2fa3655466a6f87487ddf2786470d677292d8f9e05526e072dca73ec169292ad920a",
            "6172f0be7f5a74489e3963e56f51354d4e6d148466518aa9bcc8c75c65a5051017cc272cc691c9f06d1dca0ea99cb8780a",
            "64acd9d4c288455f8cf7b577603a8a87d3040d1f00296c98290f77395cfa1d85c6cdf6dbe30d08ab624ba07f65d7b3180a",
            "679d30e5dbe4c1d7f7ee4d6ce61fa32ecb3133dbd6e87bf7e2e659aebf6a1fc6cb3a8295d7ffc82c4a49b9d9f8cc585b0a",
            "6d1afbb79b406b9d6cf01029b36522e79e6c44ce5098f012229673261dc8f838b195f06e19912aa989d44b53b167b03e0a",
            "6e7b35b31eae5e6c2c7eaf5def21c3b3321e1acee059125b714ed942e5f3ace9421ce9a5d081ab5c15f8e7ad3cc2d8000a",
            "6fd0a34a6578578854ac17f2cb52c3fe5c54c00a51f031863f1266fe050c4c12535b089fb2e7dc95898400b5cb915c910a",
            "6fef9c977d571e9d693bbbded15f0ccd69402066525f2fbc4549e39aa0cba95cb98fb22a6755f43c1b6307b16eae7ac40a",
            "72436adcdfba27e5b6cbf56ea569f5bae6fa2bd15d5d6b74749c574e2198befbdbbd286b170538e7f7867583f71cdafe0a",
            "74c965e3fca146e2971167d61f7c1b785fd631dec2e3db324c60cecf09fe54d78a283037d69f520134689986aeb343800a",
            "78a3d6e7033f5286662a4fd8b653b2643a0e8a7affb917e2f03c37cb4842f1f0ed5ebc85e3284600018b8d1e314b06fa0a",
            "78ad542929bd2cc7f669ac3c5f48e9e4aa44d4ccc4c3dd12aafd1319cbc526a7f201426b96451c5d456c670869a7ca640a",
            "78db5c649dd3bf09d8d7e4e6a5d88bf90fd4ebf19a029a5a334129ddf3a3b9f72952a71c1be1fba59cf66905d06091880a",
            "7e6132ec30476350222774efdbc329e8f6b427842310ad651a2476bab93f7e9e4777d325ab7c9a6b8599400813370f150a",
            "7ef3d1b026d341b7d1a65774ffaaa7850b5dacbd4d177a378cbf18da4ef3e6c8a28da4948990d8f2722d3250c05865770a",
            "81cabbff9f602e59d93e682e7258a53229c95652da0b46be313b787fc4e7eef9c869cd4f9f16541a87c4ca14fd9fe80f0a",
            "871898e213eac71bfcd6509e00c0ddd4f7368f01d59d63742301d89acf4b4d6b2599f5aee539074edcb5c9ef007230bb0a",
            "87aac93d241f3c4b79fa9d651b52026eb1e94b6bea07268f2fed29f078071d2b3e9c1a2de7e75b3baf332a5a548a1f750a",
            "88683bb03c68c9e3efe535909ad1fcd2cf29d860df394aaa77fdab1172de56848b8a898114451029da0a894c167082cf0a",
            "8b4ae67e74d9cac5df1ed95669be0b2f7ae8897befee26f325266a5db530a9875de3fd418290a3c65590a307d4787acb0a",
            "8ba8d3cd17c1261be2448aefd9ad3fc050617b055736bb32d828ccf6d9bcba76f9d35adf0530912c0da4bfaf866994c50a",
            "8f67cfcfe82349fb05051c9949e1ee12c13c908ab352d5363e502ee7c87805b240fb466faefb2b314aec593ffd3042690a",
            "90b202eabbcd77d4d87ec9a9daff304bf7c075baa55c994349fd9cc42aa1072a342bbab3e7ad0b638f832ae5389ee35e0a",
            "93a3747b4efde4a16b45f482eea8a5d96b12da391a970665db0b87fda226ef9128365d557304dc817ca0e77d3973ed460a",
            "9fb5d85f28525df2bb65228643c4e94a6108f024d3bea40004cfe2ea8a97ed7f9b7d38504b98a56b0e3f1691a297dce00a",
            "a1981c2e4b023d5dd7000862772c869e7deb7e34e249149b443671527d1e2b545a2919fad64b5f36ae0901d208a5eccb0a",
            "a4002c49d18221215fdd1c5308d2b9404996b976f287c125d489c5ca8b58aa0eb9bcfc2f93d59f94a11163e8f3641d210a",
            "a534f70bb688b3f626cb78cf89b18b60a169ab1e9eea281ff91864b8ef659bec6e9e9efbc6efb7591cd385fdfab45b250a",
            "a8d78595c581acfe62c0ed067a041a85802d791044b9fef10215701dc54061758e9d280394ef6160c102cee724f444c60a",
            "a915fbd5e4aaff74dd7ea10aadf8cc8dfc43ac1460ebe29fb5173e2203c0ae7dfe6f3bd745dfbfe9df5cf2983b5974740a",
            "a97cc58c41db8dc01ac125871f9c1e9782937e187ca5b71a6570cfea219f2ba19c4ec81910418301925b942df67bcd280a",
            "a9f6b15fb4381aab661c142433cb19da3843be5fbf501000e8e84c8b3458c76f1e040eb32c30d0e102473758f3dafe8f0a",
            "aa4276cce2dd19f1443348d4044ba4382a3f51d76f68214bf782bd32322cae50325de1ef3ed2a07384eedf681bc616470a",
            "ab085a273a5eb6250ee6d8fe4a20b24b83e7491cbffe8e09c5915fb9b01cca969d254ccd820ba4c1e226cd88f2cd19de0a",
            "ad2a330836036b7782903bd49b734a126c986d1e0f577ccec51bbb5768ade3b63d0fe227bcf615d310fa2f0f66b41a190a",
            "b34571f7a514534c34567050c58f06744998a72008496191b83d113b8104378a60691e3f824e0cad3ed5a429b49555550a",
            "b59061e1d7356582b6f0043b745e94d390e1aaad215ea6e0dc4b573c67d09704c269dfe2b3608969149a75a931adf1800a",
            "b61592585ffe1b011b98cf2620932ec3b2d32a02eaeb7a4d3cea480d40ffb3b0a7c8e748fb8a86a2b4b012372cd56dc80a",
            "b696555128dce79b6f10aea1e0e04e788c04d356790e7be2726316632453c546120f8f0b1e56aa13bf36a09626ceef430a",
            "b6be63058acaab078ded34481c267e9ee3891be9259cbe2ba3d99fa81f8cc7a5c03328db22749df00e591b68caee63030a",
            "b6be7c1d9101f7a4ee09aa4222e548fe4cfa4ec924d989e8c6994828bf6e483515189c6a137c46136b396a87f1bb0dce0a",
            "b7341a21f0a40f8fbb9bb66433b681d93d5c089b218608b627ecec59fcd66753cf7a75db5003c807c452f604662383c40a",
            "b8f1551c186dede30a6efad968a4bc23981c6e259ce56f8a081dae8181b093a038e40d4d78b18774883bc50439c450870a",
            "bf753fab8d183e8ac3ac99ce3e95d4baffbd65fb8e7a0127cb75415531df762d7d56638c3c07daef670d1ea0817df5cb0a",
            "c0d1f0a609ba86c5fe8928fefbd4057acb570206ae1be940258664c4bf861dbfd4fe56353e900fe8224ded5ffef2c9130a",
            "c0f12fd4f68d96ea28f1981ee79077f5db09781043fbd6c8efce9b7486486aaf8eb4b0dde7664e5abdd4d2c7ee9bc5fb0a",
            "c18f658ec9ca07444d4b425e4637c8cb270931a36259230eebb3816d17e6be8ad5951c60c50652dc3d9bcdd8f2dc05cd0a",
            "c4030ffa0e62b9bc8a9f859ef211edabe7e311ef5192455e0a398d6c7150a79c50a2b2e1b9dd71d20c01b6f6b1462d300a",
            "c43b9734a76ba6cb60740a3fc5cc02b79266b80a9ede9312dd977a74edb24132578b277019ed15509d9cc5b54af60e420a",
            "c46642c8884cc01caceb6d114e490dca036eb7ba4beb21d91888bedf12cc52b41e45f27e366ec9700c3faaf63e0b12620a",
            "c57a2eac8a7d1b73b2093deaf3f10e84dc984bb07cc2acb263ddb29f86fb1832f15689515a9c97baae4d5d5da243f12f0a",
            "c62b881dcfe531cf2b25956b5bf6b93b1dc563afb1f37a26a0ee3460d42e92372c2d4bd1edf391e2469ef19b6afdb5610a",
            "c6ec2a3be9ba0e7813e79a3f71b17bcc3881c21fd02367dd64b515c8822352a8937fa7b6be5617f0e57e115b0bdd09360a",
            "c9d3ee8600299b16e139c73bd27acaab43f34473c0f33f1f5092ee8759894bc7a92176d4b35e9c21f285a101d66ed1c80a",
            "ca5b002a3f71b32590c0714275e79e2fbc835a664713ef7cc8c5771e8d991758616caaea5059cdad57e3e66686d5c49d0a",
            "cab8941f2909e99e10d96574564ba1f5846a872939a035b69b29445664918e87729b18f6d193eee11ac27c24e41478050a",
            "cbd2e6a95907d6932e42c56e32eda48efc7e204d16df8beea881db371ae40f5a4fb81be7d976306a0d5abcdb7008d76e0a",
            "ceb8c9a6a5850aad1a2e1525bb10e81fba6def3937693b4ab0cec8dbace7c1f6e5af13311da343a51042217907e47ae70a",
            "d03d53b3e053622a5a6e444fb46ff5fadfc80a5fdbfab04eabf36e8711cc6844052b23d83060a701007e227d42f25cef0a",
            "d5c729a2f7defc2864b0475f25cc0e6d6dc04ee9de9657697267696da4a0bb82a0bcb5c62a0d03e1edfe9e0a199cd7680a",
            "d62b5aa9b02d6ab9ec0d5840ddb8fae41456feef2ef6ee1ecc1203005132fe4f8404711e76a22d1fd0db5dead0a9218b0a",
            "e04d92c75c5ec62110cbbb435c7f3e8d150d43219bfd6be0caab1ffbb14d4e341ec731e42f1538d34a8f2b11a7966b3c0a",
            "e2b34a636eecce0f6ff270d4b06b5a13166e8c121fec6dc45e1438e95b166505be6c5ce2ab9233ed4b9efcfdfad26d6a0a",
            "e314295a5cde5a45b265317b6f5765bdbbf891651cf1fd10b7c49da66e1b0263b17fffc2571a05085e492179dc7152250a",
            "e4cc2b450c5c1f799f192bfdec2576304f0e994397b1f7306b828f8890457e975a4291b8763d85f6a1ef5a0e0b8d2c270a",
            "e4d2d8e39094f600e0140917ffbc69f86bb767b610a52c6bbc337e339bea3d4a3e4c2ea80da593ea07b8d55be1b9bbdd0a",
            "e53b39f0cc83f03647784ea8cef2b1431d847fae623afbe1952b6524f3d61595d063beb4a5192e8d32f5b0be920b5ec80a",
            "e55f853a56c786982e7773bbace43a9aac415142591599ac2084f92117acce5bcc8be839d67a6834365c40ffbb57f7b60a",
            "e6c533f12c6a0c3c81bbfe9d07d3b505d8b0fc6eb5f7318b4bf53ac000d0541653704467efee786f244f51edc0fd4f890a",
            "e7f4a2d53a27c43cb5d734599c3f905c8784cddc19fb9856af9d9fa42d9d075ab4852c219311455a094f0813ce69a9c30a",
            "e849aa763a5767407359f311b1138efe1ff00da9e8e98fa338f25affa2c405d78d3313eedbfbfb5f7e3697f311b7f7da0a",
            "ebbd147f8bab60310a3299de57dbaffc7bff2e10cd7ffc130d35bd3d287ab17c4b6a86fc144ccde30f8d84fc9899c44b0a",
            "ebc3b54e06d4744459d0e3ff7bc2f9ea88f7030092117dcbb9669fc4acb14c2b1771e8e08e1e25c66da42d10ea0e349e0a",
            "ede4844f831870fddc09f87e676878a759180912fe13864f4ea903e6350fe45675264ce25e0faafb080a0a4432ff85640a",
            "efd2980f2013196958594273f19fb6da00335a5a4cd8bbf78d3664463c4438bb4eb743e158fed7edab848f892e02767e0a",
            "f3d86a6746e93ddf70606cc6fdefff2c26943635f6ceea668d4a59268a8623d05c6a37d8346579409a54f6771447ddf00a",
            "f873a52a88bf2749e97cc03118ad7d8c6e0e35672ef6487426763ce6dd20c5ea4598ad272ecddd8ca8d9928addb189780a",
            "f92e1f55a99080861066786b7cd15599ae3e4d356c80f1dfa651c6b8b6d5bc14962e527e34c489ac4f1efe6952b83fec0a",
            "fb26a71cd8dc61c770c6c3ad2d884c8ec472016d56716635ac88e7276721da6eff808b1a740807c133f8cf1f4a095d590a",
            "fb5fcd67f6375b4a3c002c631d74dc045f510f8b779d13cb32f3f0db14931a27bcd9aea4f0140884db79bd83580e92ff0a",
            "fcf59a0ad0c2768ca77fc3da1ab5933f3fd4bc79ec65b977af6778bbbe0fc82eff419747ed1da71f2bbd97f6eedaafe30a",
            "4562fa5193c470e59ba967f35cb0a9e7ebd1457499d5486b3b156e3cc5e65da764cdf56c6dda7c9443168b37f10abb360a",
    };

    std::vector<std::shared_ptr<Manifest>> manifestList{};
    std::vector<std::shared_ptr<Tatsu>> tatsuList{};
    const auto &manifestPath = fmt::format("{0}/{1}", std::string(std::filesystem::current_path()), std::string("BuildManifest.plist"));
    auto manifest = std::make_shared<Manifest>(manifestPath);
    if(!manifest->isValid()) {
        return -1;
    }
    manifestList.emplace_back(manifest);

    for(const auto &dgst : checkDigests) {
        auto tmp = std::move(manifest);
        if(!tmp->isValid()) {
            fmt::print(fg(fmt::color::crimson), "{0}: Manifest isn't valid!\n", __PRETTY_FUNCTION__);
            return -1;
        }
        digestList[0] = dgst;
        fmt::print(fg((fmt::color)0x00c200), "{0}: Saving Digest: {1}\n", __PRETTY_FUNCTION__, dgst);
        std::pair<std::vector<std::string>, std::vector<std::string>> pair(compList, digestList);

        auto tmp2 = std::make_shared<Tatsu>(tmp, 0x8015, "d22ap", 0x69, ERASE, 0x1111111111111111, "", "",
                                            std::vector<std::string>{}, pair);
        tatsuList.emplace_back(tmp2);
        manifestList.emplace_back(tmp);
        manifest = std::move(tmp);
//        manifestList.clear();
        std::chrono::duration<double, std::milli> requestDuration(800);
        std::this_thread::sleep_for(requestDuration);
    }
    return 0;
}
